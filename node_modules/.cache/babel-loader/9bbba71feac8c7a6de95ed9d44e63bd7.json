{"ast":null,"code":"var _jsxFileName = \"/Users/yuzi/react/incremental_search/src/components/IncrementalSearch.js\";\nimport * as React from 'react';\nimport * as styles from './incrementalSearch.scss';\n\nclass IncrementalSearch extends React.Component {\n  /*\n  readonly state: {\n  searchWord: strin;\n  value: string;\n  focus: HTMLLIElement | HTMLInputElement | undefined;\n  listScrolling: boolean;\n  }\n  */\n  constructor(props) {\n    super(props);\n    this.rootElement = React.createRef();\n    this.ulElement = React.createRef();\n    this.inputElement = React.createRef();\n    this.state = {\n      value: this.props.value,\n      searchWord: '',\n      focus: undefined,\n      listScrolling: false\n    };\n    this.Input = this.Input.bind(this);\n    this.ListItem = this.ListItem.bind(this);\n    this.switch = this.switch.bind(this);\n  }\n\n  filter(option) {\n    return option.map(function (s) {\n      return s.match(new RegExp(this.state.searchWord.replace(' ', '|'), 'i'));\n    });\n  }\n\n  unLockScroll() {\n    document.body.classList.remove(styles.lock);\n    this.rootElement.current && this.rootElement.current.classList.remove(styles.lock);\n  }\n\n  lockScroll() {\n    document.body.classList.add(styles.lock);\n    this.rootElement.current && this.rootElement.current.classList.add(styles.lock);\n  }\n\n  scrollYTo(y\n  /* :number */\n  )\n  /* void */\n  {\n    this.setState({\n      listScrolling: true\n    });\n    this.rootElement.current.scrollTo(0, y);\n    this.setState({\n      listScrolling: false\n    });\n  }\n\n  onBlur() {\n    this.setState({\n      focus: undefined\n    });\n    clearTimeout(this.time);\n    this.time = setTimeout(() => {\n      if (this.state.focus === undefined) {\n        this.setState({\n          searchWord: ''\n        });\n      }\n    }, 200);\n  }\n\n  focus(element) {\n    element.focus();\n    this.setState({\n      focus: element\n    });\n  } //time;\n\n\n  Input() {\n    var KeyMap;\n    KeyMap.enter = 13;\n    KeyMap.allowDown = 40;\n    KeyMap.allowUp = 38;\n    return React.createElement(\"input\", {\n      ref: this.inputElement,\n      placeholder: \"input here\",\n      className: styles.input,\n      autoFocus: true,\n      onKeyDown: e => {\n        this.lockScroll();\n\n        if (e.keyCode === KeyMap.enter || e.keyCode === KeyMap.allowDown) {\n          try {\n            this.ulElement.current && this.focus(this.ulElement.current.children[0]);\n          } catch (e) {\n            console.error(e);\n          }\n        }\n      },\n      onFocus: e => this.setState({\n        focus: e.currentTarget\n      }),\n      onKeyUp: e => {\n        this.unLockScroll();\n        this.setState({\n          searchWord: e.currentTarget.value\n        });\n      },\n      onBlur: () => this.onBlur(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84\n      },\n      __self: this\n    });\n  }\n\n  ListItem(props) {\n    var KeyMap;\n    KeyMap.enter = 13;\n    KeyMap.allowDown = 40;\n    KeyMap.allowUp = 38;\n    return React.createElement(\"li\", {\n      className: styles.li,\n      tabIndex: 0,\n      onMouseOver: e => {\n        if (!this.state.listScrolling) {\n          this.focus(e.currentTarget);\n        }\n      },\n      onKeyDown: e => {\n        this.lockScroll();\n\n        if (e.keyCode === KeyMap.enter) {\n          e.currentTarget.click();\n          e.preventDefault();\n        } else if (e.keyCode === KeyMap.allowUp && e.currentTarget.previousSibling) {\n          this.focus(e.currentTarget.previousSibling);\n        } else if (e.keyCode === KeyMap.allowDown) {\n          e.currentTarget.nextSibling && this.focus(e.currentTarget.nextSibling);\n        } else {\n          this.inputElement.current && this.focus(this.inputElement.current);\n        }\n      },\n      onFocus: e => this.setState({\n        focus: e.currentTarget\n      }),\n      onKeyUp: e => {\n        const heightHalf = this.rootElement.current.clientHeight / 2;\n        this.unLockScroll();\n        if (e.currentTarget.offsetTop < heightHalf) this.scrollYTo(0);else this.scrollYTo(e.currentTarget.offsetTop - heightHalf);\n      },\n      onClick: e => {\n        this.unLockScroll();\n        this.props.onChenge(e.currentTarget.innerHTML.replace(/&amp;/, '&'));\n        this.setState({\n          value: e.currentTarget.innerHTML.replace(/&amp;/, '&'),\n          searchWord: ''\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116\n      },\n      __self: this\n    }, props.children);\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      ref: this.rootElement,\n      className: styles.incrementalSearch,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: styles.search,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166\n      },\n      __self: this\n    }, React.createElement(this.Input, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167\n      },\n      __self: this\n    })), this.filter(this.props.option).length > 0 && React.createElement(\"ul\", {\n      className: styles.ul,\n      ref: this.ulElement,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170\n      },\n      __self: this\n    }, this.filter(this.props.option).map(s => React.createElement(this.ListItem, {\n      key: s,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172\n      },\n      __self: this\n    }, s))));\n  }\n\n}\n\nexport default IncrementalSearch;","map":{"version":3,"sources":["/Users/yuzi/react/incremental_search/src/components/IncrementalSearch.js"],"names":["React","styles","IncrementalSearch","Component","constructor","props","rootElement","createRef","ulElement","inputElement","state","value","searchWord","focus","undefined","listScrolling","Input","bind","ListItem","switch","filter","option","map","s","match","RegExp","replace","unLockScroll","document","body","classList","remove","lock","current","lockScroll","add","scrollYTo","y","setState","scrollTo","onBlur","clearTimeout","time","setTimeout","element","KeyMap","enter","allowDown","allowUp","input","e","keyCode","children","console","error","currentTarget","li","click","preventDefault","previousSibling","nextSibling","heightHalf","clientHeight","offsetTop","onChenge","innerHTML","render","incrementalSearch","search","length","ul"],"mappings":";AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,OAAO,KAAKC,MAAZ,MAAwB,0BAAxB;;AAEA,MAAMC,iBAAN,SAAgCF,KAAK,CAACG,SAAtC,CAAgD;AAC5C;;;;;;;;AASFC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;AADiB,SAmBnBC,WAnBmB,GAmBLN,KAAK,CAACO,SAAN,EAnBK;AAAA,SAoBnBC,SApBmB,GAoBPR,KAAK,CAACO,SAAN,EApBO;AAAA,SAqBnBE,YArBmB,GAqBJT,KAAK,CAACO,SAAN,EArBI;AAEjB,SAAKG,KAAL,GAAa;AACTC,MAAAA,KAAK,EAAE,KAAKN,KAAL,CAAWM,KADT;AAETC,MAAAA,UAAU,EAAE,EAFH;AAGTC,MAAAA,KAAK,EAAEC,SAHE;AAITC,MAAAA,aAAa,EAAE;AAJN,KAAb;AAMA,SAAKC,KAAL,GAAa,KAAKA,KAAL,CAAWC,IAAX,CAAgB,IAAhB,CAAb;AACA,SAAKC,QAAL,GAAgB,KAAKA,QAAL,CAAcD,IAAd,CAAmB,IAAnB,CAAhB;AACA,SAAKE,MAAL,GAAc,KAAKA,MAAL,CAAYF,IAAZ,CAAiB,IAAjB,CAAd;AACD;;AAEDG,EAAAA,MAAM,CAACC,MAAD,EAAS;AACb,WAAOA,MAAM,CAACC,GAAP,CAAW,UAASC,CAAT,EAAY;AAC5B,aAAOA,CAAC,CAACC,KAAF,CAAQ,IAAIC,MAAJ,CAAW,KAAKf,KAAL,CAAWE,UAAX,CAAsBc,OAAtB,CAA8B,GAA9B,EAAmC,GAAnC,CAAX,EAAoD,GAApD,CAAR,CAAP;AACD,KAFM,CAAP;AAGD;;AAMDC,EAAAA,YAAY,GAAG;AACbC,IAAAA,QAAQ,CAACC,IAAT,CAAcC,SAAd,CAAwBC,MAAxB,CAA+B9B,MAAM,CAAC+B,IAAtC;AACA,SAAK1B,WAAL,CAAiB2B,OAAjB,IACE,KAAK3B,WAAL,CAAiB2B,OAAjB,CAAyBH,SAAzB,CAAmCC,MAAnC,CAA0C9B,MAAM,CAAC+B,IAAjD,CADF;AAED;;AAEDE,EAAAA,UAAU,GAAG;AACXN,IAAAA,QAAQ,CAACC,IAAT,CAAcC,SAAd,CAAwBK,GAAxB,CAA4BlC,MAAM,CAAC+B,IAAnC;AACA,SAAK1B,WAAL,CAAiB2B,OAAjB,IACE,KAAK3B,WAAL,CAAiB2B,OAAjB,CAAyBH,SAAzB,CAAmCK,GAAnC,CAAuClC,MAAM,CAAC+B,IAA9C,CADF;AAED;;AAEDI,EAAAA,SAAS,CAACC;AAAE;AAAH;AAAkB;AAAW;AACpC,SAAKC,QAAL,CAAc;AAACvB,MAAAA,aAAa,EAAE;AAAhB,KAAd;AACC,SAAKT,WAAL,CAAiB2B,OAAlB,CAA2BM,QAA3B,CAAoC,CAApC,EAAuCF,CAAvC;AACA,SAAKC,QAAL,CAAc;AAACvB,MAAAA,aAAa,EAAE;AAAhB,KAAd;AACD;;AAEDyB,EAAAA,MAAM,GAAG;AACP,SAAKF,QAAL,CAAc;AACZzB,MAAAA,KAAK,EAAEC;AADK,KAAd;AAGA2B,IAAAA,YAAY,CAAC,KAAKC,IAAN,CAAZ;AACA,SAAKA,IAAL,GAAYC,UAAU,CAAC,MAAM;AAC3B,UAAI,KAAKjC,KAAL,CAAWG,KAAX,KAAqBC,SAAzB,EAAoC;AAClC,aAAKwB,QAAL,CAAc;AACZ1B,UAAAA,UAAU,EAAE;AADA,SAAd;AAGD;AACF,KANqB,EAMnB,GANmB,CAAtB;AAOD;;AAEDC,EAAAA,KAAK,CAAC+B,OAAD,EAAU;AACbA,IAAAA,OAAO,CAAC/B,KAAR;AACA,SAAKyB,QAAL,CAAc;AACZzB,MAAAA,KAAK,EAAE+B;AADK,KAAd;AAGD,GAtE6C,CAwE9C;;;AAEA5B,EAAAA,KAAK,GAAG;AACN,QAAI6B,MAAJ;AACAA,IAAAA,MAAM,CAACC,KAAP,GAAgB,EAAhB;AACAD,IAAAA,MAAM,CAACE,SAAP,GAAmB,EAAnB;AACAF,IAAAA,MAAM,CAACG,OAAP,GAAiB,EAAjB;AACA,WACE;AACE,MAAA,GAAG,EAAE,KAAKvC,YADZ;AAEE,MAAA,WAAW,cAFb;AAGE,MAAA,SAAS,EAAER,MAAM,CAACgD,KAHpB;AAIE,MAAA,SAAS,MAJX;AAKE,MAAA,SAAS,EAAEC,CAAC,IAAI;AACd,aAAKhB,UAAL;;AACA,YAAIgB,CAAC,CAACC,OAAF,KAAcN,MAAM,CAACC,KAArB,IAA8BI,CAAC,CAACC,OAAF,KAAcN,MAAM,CAACE,SAAvD,EAAkE;AAChE,cAAI;AACF,iBAAKvC,SAAL,CAAeyB,OAAf,IACE,KAAKpB,KAAL,CAAW,KAAKL,SAAL,CAAeyB,OAAf,CAAuBmB,QAAvB,CAAgC,CAAhC,CAAX,CADF;AAED,WAHD,CAGE,OAAOF,CAAP,EAAU;AACVG,YAAAA,OAAO,CAACC,KAAR,CAAcJ,CAAd;AACD;AACF;AACF,OAfH;AAgBE,MAAA,OAAO,EAAEA,CAAC,IAAI,KAAKZ,QAAL,CAAc;AAAEzB,QAAAA,KAAK,EAAEqC,CAAC,CAACK;AAAX,OAAd,CAhBhB;AAiBE,MAAA,OAAO,EAAEL,CAAC,IAAI;AACZ,aAAKvB,YAAL;AACA,aAAKW,QAAL,CAAc;AAAE1B,UAAAA,UAAU,EAAEsC,CAAC,CAACK,aAAF,CAAgB5C;AAA9B,SAAd;AACD,OApBH;AAqBE,MAAA,MAAM,EAAE,MAAM,KAAK6B,MAAL,EArBhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF;AAyBD;;AAEDtB,EAAAA,QAAQ,CAACb,KAAD,EAAQ;AACd,QAAIwC,MAAJ;AACAA,IAAAA,MAAM,CAACC,KAAP,GAAgB,EAAhB;AACAD,IAAAA,MAAM,CAACE,SAAP,GAAmB,EAAnB;AACAF,IAAAA,MAAM,CAACG,OAAP,GAAiB,EAAjB;AACA,WACE;AACE,MAAA,SAAS,EAAE/C,MAAM,CAACuD,EADpB;AAEE,MAAA,QAAQ,EAAE,CAFZ;AAGE,MAAA,WAAW,EAAEN,CAAC,IAAI;AAChB,YAAI,CAAC,KAAKxC,KAAL,CAAWK,aAAhB,EAA+B;AAC/B,eAAKF,KAAL,CAAWqC,CAAC,CAACK,aAAb;AACC;AACF,OAPH;AAQE,MAAA,SAAS,EAAEL,CAAC,IAAI;AACd,aAAKhB,UAAL;;AACA,YAAIgB,CAAC,CAACC,OAAF,KAAcN,MAAM,CAACC,KAAzB,EAAgC;AAC9BI,UAAAA,CAAC,CAACK,aAAF,CAAgBE,KAAhB;AACAP,UAAAA,CAAC,CAACQ,cAAF;AACD,SAHD,MAGO,IACLR,CAAC,CAACC,OAAF,KAAcN,MAAM,CAACG,OAArB,IACAE,CAAC,CAACK,aAAF,CAAgBI,eAFX,EAGL;AACA,eAAK9C,KAAL,CAAWqC,CAAC,CAACK,aAAF,CAAgBI,eAA3B;AACD,SALM,MAKA,IAAIT,CAAC,CAACC,OAAF,KAAcN,MAAM,CAACE,SAAzB,EAAoC;AACzCG,UAAAA,CAAC,CAACK,aAAF,CAAgBK,WAAhB,IACE,KAAK/C,KAAL,CAAWqC,CAAC,CAACK,aAAF,CAAgBK,WAA3B,CADF;AAED,SAHM,MAGA;AACL,eAAKnD,YAAL,CAAkBwB,OAAlB,IAA6B,KAAKpB,KAAL,CAAW,KAAKJ,YAAL,CAAkBwB,OAA7B,CAA7B;AACD;AACF,OAxBH;AAyBE,MAAA,OAAO,EAAEiB,CAAC,IAAI,KAAKZ,QAAL,CAAc;AAAEzB,QAAAA,KAAK,EAAEqC,CAAC,CAACK;AAAX,OAAd,CAzBhB;AA0BE,MAAA,OAAO,EAAEL,CAAC,IAAI;AACZ,cAAMW,UAAU,GACb,KAAKvD,WAAL,CAAiB2B,OAAlB,CAA2B6B,YAA3B,GAA0C,CAD5C;AAEA,aAAKnC,YAAL;AACA,YAAIuB,CAAC,CAACK,aAAF,CAAgBQ,SAAhB,GAA4BF,UAAhC,EAA4C,KAAKzB,SAAL,CAAe,CAAf,EAA5C,KACK,KAAKA,SAAL,CAAec,CAAC,CAACK,aAAF,CAAgBQ,SAAhB,GAA4BF,UAA3C;AACN,OAhCH;AAiCE,MAAA,OAAO,EAAEX,CAAC,IAAI;AACZ,aAAKvB,YAAL;AACA,aAAKtB,KAAL,CAAW2D,QAAX,CAAoBd,CAAC,CAACK,aAAF,CAAgBU,SAAhB,CAA0BvC,OAA1B,CAAkC,OAAlC,EAA2C,GAA3C,CAApB;AACA,aAAKY,QAAL,CAAc;AACZ3B,UAAAA,KAAK,EAAEuC,CAAC,CAACK,aAAF,CAAgBU,SAAhB,CAA0BvC,OAA1B,CAAkC,OAAlC,EAA2C,GAA3C,CADK;AAEZd,UAAAA,UAAU,EAAE;AAFA,SAAd;AAID,OAxCH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OA0CGP,KAAK,CAAC+C,QA1CT,CADF;AA8CD;;AAEDc,EAAAA,MAAM,GAAG;AACP,WACE;AAAK,MAAA,GAAG,EAAE,KAAK5D,WAAf;AAA4B,MAAA,SAAS,EAAEL,MAAM,CAACkE,iBAA9C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAK,MAAA,SAAS,EAAElE,MAAM,CAACmE,MAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,yBAAM,KAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CADF,EAIG,KAAKhD,MAAL,CAAY,KAAKf,KAAL,CAAWgB,MAAvB,EAA+BgD,MAA/B,GAAwC,CAAxC,IACC;AAAI,MAAA,SAAS,EAAEpE,MAAM,CAACqE,EAAtB;AAA0B,MAAA,GAAG,EAAE,KAAK9D,SAApC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACG,KAAKY,MAAL,CAAY,KAAKf,KAAL,CAAWgB,MAAvB,EAA+BC,GAA/B,CAAmCC,CAAC,IACnC,yBAAM,QAAN;AAAe,MAAA,GAAG,EAAEA,CAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAwBA,CAAxB,CADD,CADH,CALJ,CADF;AAcD;;AA9K6C;;AAiLhD,eAAerB,iBAAf","sourcesContent":["import * as React from 'react';\nimport * as styles from './incrementalSearch.scss';\n\nclass IncrementalSearch extends React.Component {\n    /*\n  readonly state: {\n    searchWord: strin;\n    value: string;\n    focus: HTMLLIElement | HTMLInputElement | undefined;\n    listScrolling: boolean;\n  }\n  */\n\n  constructor(props) {\n    super(props);\n    this.state = {\n        value: this.props.value,\n        searchWord: '',\n        focus: undefined,\n        listScrolling: false,\n    };\n    this.Input = this.Input.bind(this);\n    this.ListItem = this.ListItem.bind(this);\n    this.switch = this.switch.bind(this);\n  }\n\n  filter(option) {\n    return option.map(function(s) {\n      return s.match(new RegExp(this.state.searchWord.replace(' ', '|'), 'i'));\n    });\n  }\n\n  rootElement = React.createRef();\n  ulElement = React.createRef();\n  inputElement = React.createRef();\n\n  unLockScroll() {\n    document.body.classList.remove(styles.lock);\n    this.rootElement.current &&\n      this.rootElement.current.classList.remove(styles.lock);\n  }\n\n  lockScroll() {\n    document.body.classList.add(styles.lock);\n    this.rootElement.current &&\n      this.rootElement.current.classList.add(styles.lock);\n  }\n\n  scrollYTo(y /* :number */) /* void */ {\n    this.setState({listScrolling: true});\n    (this.rootElement.current).scrollTo(0, y);\n    this.setState({listScrolling: false});\n  }\n\n  onBlur() {\n    this.setState({\n      focus: undefined\n    });\n    clearTimeout(this.time);\n    this.time = setTimeout(() => {\n      if (this.state.focus === undefined) {\n        this.setState({\n          searchWord: ''\n        });\n      }\n    }, 200);\n  }\n\n  focus(element) {\n    element.focus();\n    this.setState({\n      focus: element\n    });\n  }\n\n  //time;\n\n  Input() {\n    var KeyMap;\n    KeyMap.enter =  13;\n    KeyMap.allowDown = 40;\n    KeyMap.allowUp = 38;\n    return (\n      <input\n        ref={this.inputElement}\n        placeholder={`input here`}\n        className={styles.input}\n        autoFocus\n        onKeyDown={e => {\n          this.lockScroll();\n          if (e.keyCode === KeyMap.enter || e.keyCode === KeyMap.allowDown) {\n            try {\n              this.ulElement.current &&\n                this.focus(this.ulElement.current.children[0]);\n            } catch (e) {\n              console.error(e);\n            }\n          }\n        }}\n        onFocus={e => this.setState({ focus: e.currentTarget })}\n        onKeyUp={e => {\n          this.unLockScroll();\n          this.setState({ searchWord: e.currentTarget.value });\n        }}\n        onBlur={() => this.onBlur()}\n      />\n    );\n  }\n\n  ListItem(props) {\n    var KeyMap;\n    KeyMap.enter =  13;\n    KeyMap.allowDown = 40;\n    KeyMap.allowUp = 38;\n    return (\n      <li\n        className={styles.li}\n        tabIndex={0}\n        onMouseOver={e => {\n          if (!this.state.listScrolling) {\n          this.focus(e.currentTarget);\n          }\n        }}\n        onKeyDown={e => {\n          this.lockScroll();\n          if (e.keyCode === KeyMap.enter) {\n            e.currentTarget.click();\n            e.preventDefault();\n          } else if (\n            e.keyCode === KeyMap.allowUp &&\n            e.currentTarget.previousSibling\n          ) {\n            this.focus(e.currentTarget.previousSibling);\n          } else if (e.keyCode === KeyMap.allowDown) {\n            e.currentTarget.nextSibling &&\n              this.focus(e.currentTarget.nextSibling);\n          } else {\n            this.inputElement.current && this.focus(this.inputElement.current);\n          }\n        }}\n        onFocus={e => this.setState({ focus: e.currentTarget })}\n        onKeyUp={e => {\n          const heightHalf =\n            (this.rootElement.current).clientHeight / 2;\n          this.unLockScroll();\n          if (e.currentTarget.offsetTop < heightHalf) this.scrollYTo(0);\n          else this.scrollYTo(e.currentTarget.offsetTop - heightHalf);\n        }}\n        onClick={e => {\n          this.unLockScroll();\n          this.props.onChenge(e.currentTarget.innerHTML.replace(/&amp;/, '&'));\n          this.setState({\n            value: e.currentTarget.innerHTML.replace(/&amp;/, '&'),\n            searchWord: ''\n          });\n        }}\n      >\n        {props.children}\n      </li>\n    );\n  }\n\n  render() {\n    return (\n      <div ref={this.rootElement} className={styles.incrementalSearch}>\n        <div className={styles.search}>\n          <this.Input />\n        </div>\n        {this.filter(this.props.option).length > 0 && (\n          <ul className={styles.ul} ref={this.ulElement}>\n            {this.filter(this.props.option).map(s => (\n              <this.ListItem key={s}>{s}</this.ListItem>\n            ))}\n          </ul>\n        )}\n      </div>\n    );\n  }\n}\n\nexport default IncrementalSearch;\n"]},"metadata":{},"sourceType":"module"}