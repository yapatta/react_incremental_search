{"ast":null,"code":"var _jsxFileName = \"/Users/yuzi/react/incremental_search/src/components/IncrementalSearch.js\";\nimport * as React from 'react';\nimport * as styles from './incrementalSearch.scss';\n\nclass IncrementalSearch extends React.Component {\n  /*\n  readonly state: {\n  searchWord: strin;\n  value: string;\n  focus: HTMLLIElement | HTMLInputElement | undefined;\n  listScrolling: boolean;\n  }\n  */\n\n  /*\n  readonly props: {\n    name: string;\n    value: string;\n    option: string[];\n    onChenge: (value: string) => void;\n    required?: boolean;\n  }\n  */\n  constructor(props) {\n    super(props);\n    this.rootElement = React.createRef();\n    this.ulElement = React.createRef();\n    this.inputElement = React.createRef();\n    this.state = {\n      value: this.props.value,\n      searchWord: '',\n      focus: undefined,\n      listScrolling: false\n    };\n    this.Input = this.Input.bind(this);\n    this.ListItem = this.ListItem.bind(this);\n  }\n\n  filter(option) {\n    return option.map(s => s.match(new RegExp(this.state.searchWord.replace(' ', '|'), 'i')));\n  }\n\n  unLockScroll() {\n    document.body.classList.remove(styles.lock);\n    this.rootElement.current && this.rootElement.current.classList.remove(styles.lock);\n  }\n\n  lockScroll() {\n    document.body.classList.add(styles.lock);\n    this.rootElement.current && this.rootElement.current.classList.add(styles.lock);\n  }\n\n  scrollYTo(y\n  /* :number */\n  )\n  /* void */\n  {\n    this.setState({\n      listScrolling: true\n    });\n    this.rootElement.current.scrollTo(0, y);\n    this.setState({\n      listScrolling: false\n    });\n  }\n\n  onBlur() {\n    this.setState({\n      focus: undefined\n    });\n    clearTimeout(this.time);\n    this.time = setTimeout(() => {\n      if (this.state.focus === undefined) {\n        this.setState({\n          searchWord: ''\n        });\n      }\n    }, 200);\n  }\n\n  focus(element) {\n    element.focus();\n    this.setState({\n      focus: element\n    });\n  }\n\n  Input() {\n    var KeyMap;\n    KeyMap.enter = 13;\n    KeyMap.allowDown = 40;\n    KeyMap.allowUp = 38;\n    return React.createElement(\"input\", {\n      ref: this.inputElement,\n      placeholder: \"input here\",\n      className: styles.input,\n      autoFocus: true,\n      onKeyDown: e => {\n        this.lockScroll();\n\n        if (e.keyCode === KeyMap.enter || e.keyCode === KeyMap.allowDown) {\n          try {\n            this.ulElement.current && this.focus(this.ulElement.current.children[0]);\n          } catch (e) {\n            console.error(e);\n          }\n        }\n      },\n      onFocus: e => this.setState({\n        focus: e.currentTarget\n      }),\n      onKeyUp: e => {\n        this.unLockScroll();\n        this.setState({\n          searchWord: e.currentTarget.value\n        });\n      },\n      onBlur: () => this.onBlur(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91\n      },\n      __self: this\n    });\n  }\n\n  ListItem(props) {\n    var KeyMap;\n    KeyMap.enter = 13;\n    KeyMap.allowDown = 40;\n    KeyMap.allowUp = 38;\n    return React.createElement(\"li\", {\n      className: styles.li,\n      tabIndex: 0,\n      onMouseOver: e => {\n        if (!this.state.listScrolling) {\n          this.focus(e.currentTarget);\n        }\n      },\n      onKeyDown: e => {\n        this.lockScroll();\n\n        if (e.keyCode === KeyMap.enter) {\n          e.currentTarget.click();\n          e.preventDefault();\n        } else if (e.keyCode === KeyMap.allowUp && e.currentTarget.previousSibling) {\n          this.focus(e.currentTarget.previousSibling);\n        } else if (e.keyCode === KeyMap.allowDown) {\n          e.currentTarget.nextSibling && this.focus(e.currentTarget.nextSibling);\n        } else {\n          this.inputElement.current && this.focus(this.inputElement.current);\n        }\n      },\n      onFocus: e => this.setState({\n        focus: e.currentTarget\n      }),\n      onKeyUp: e => {\n        const heightHalf = this.rootElement.current.clientHeight / 2;\n        this.unLockScroll();\n        if (e.currentTarget.offsetTop < heightHalf) this.scrollYTo(0);else this.scrollYTo(e.currentTarget.offsetTop - heightHalf);\n      },\n      onClick: e => {\n        this.unLockScroll();\n        this.props.onChenge(e.currentTarget.innerHTML.replace(/&amp;/, '&'));\n        this.setState({\n          value: e.currentTarget.innerHTML.replace(/&amp;/, '&'),\n          searchWord: ''\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122\n      },\n      __self: this\n    }, props.children);\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      ref: this.rootElement,\n      className: styles.incrementalSearch,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: styles.search,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167\n      },\n      __self: this\n    }, React.createElement(this.Input, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168\n      },\n      __self: this\n    })), this.filter(this.props.option).length > 0 && React.createElement(\"ul\", {\n      className: styles.ul,\n      ref: this.ulElement,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171\n      },\n      __self: this\n    }, this.filter(this.props.option).map(s => React.createElement(this.ListItem, {\n      key: s,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173\n      },\n      __self: this\n    }, s))));\n  }\n\n}\n\nexport default IncrementalSearch;","map":{"version":3,"sources":["/Users/yuzi/react/incremental_search/src/components/IncrementalSearch.js"],"names":["React","styles","IncrementalSearch","Component","constructor","props","rootElement","createRef","ulElement","inputElement","state","value","searchWord","focus","undefined","listScrolling","Input","bind","ListItem","filter","option","map","s","match","RegExp","replace","unLockScroll","document","body","classList","remove","lock","current","lockScroll","add","scrollYTo","y","setState","scrollTo","onBlur","clearTimeout","time","setTimeout","element","KeyMap","enter","allowDown","allowUp","input","e","keyCode","children","console","error","currentTarget","li","click","preventDefault","previousSibling","nextSibling","heightHalf","clientHeight","offsetTop","onChenge","innerHTML","render","incrementalSearch","search","length","ul"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport * as styles from './incrementalSearch.scss';\n\nclass IncrementalSearch extends React.Component {\n    /*\n  readonly state: {\n    searchWord: strin;\n    value: string;\n    focus: HTMLLIElement | HTMLInputElement | undefined;\n    listScrolling: boolean;\n  }\n  */\n  /*\n  readonly props: {\n    name: string;\n    value: string;\n    option: string[];\n    onChenge: (value: string) => void;\n    required?: boolean;\n  }\n  */\n  constructor(props) {\n    super(props);\n    this.state = {\n        value: this.props.value,\n        searchWord: '',\n        focus: undefined,\n        listScrolling: false,\n    };\n    this.Input = this.Input.bind(this);\n    this.ListItem = this.ListItem.bind(this);\n  }\n\n  filter(option) {\n    return option.map( s =>\n       s.match(new RegExp(this.state.searchWord.replace(' ', '|'), 'i'))\n    );\n  }\n\n  rootElement = React.createRef();\n  ulElement = React.createRef();\n  inputElement = React.createRef();\n\n  unLockScroll() {\n    document.body.classList.remove(styles.lock);\n    this.rootElement.current && this.rootElement.current.classList.remove(styles.lock);\n  }\n\n  lockScroll() {\n    document.body.classList.add(styles.lock);\n    this.rootElement.current &&\n      this.rootElement.current.classList.add(styles.lock);\n  }\n\n  scrollYTo(y /* :number */) /* void */ {\n    this.setState({listScrolling: true});\n    (this.rootElement.current).scrollTo(0, y);\n    this.setState({listScrolling: false});\n  }\n\n  onBlur() {\n    this.setState({\n      focus: undefined\n    });\n    clearTimeout(this.time);\n    this.time = setTimeout(() => {\n      if (this.state.focus === undefined) {\n        this.setState({\n          searchWord: ''\n        });\n      }\n    }, 200);\n  }\n\n  focus(element) {\n    element.focus();\n    this.setState({\n      focus: element\n    });\n  }\n\n  time;\n\n  Input() {\n    var KeyMap;\n    KeyMap.enter =  13;\n    KeyMap.allowDown = 40;\n    KeyMap.allowUp = 38;\n\n    return (\n      <input\n        ref={this.inputElement}\n        placeholder={`input here`}\n        className={styles.input}\n        autoFocus\n        onKeyDown={e => {\n          this.lockScroll();\n          if (e.keyCode === KeyMap.enter || e.keyCode === KeyMap.allowDown) {\n            try {\n              this.ulElement.current && this.focus(this.ulElement.current.children[0]);\n            } catch (e) {\n              console.error(e);\n            }\n          }\n        }}\n        onFocus={e => this.setState({ focus: e.currentTarget })}\n        onKeyUp={e => {\n          this.unLockScroll();\n          this.setState({ searchWord: e.currentTarget.value });\n        }}\n        onBlur={() => this.onBlur()}\n      />\n    );\n  }\n\n  ListItem(props) {\n    var KeyMap;\n    KeyMap.enter =  13;\n    KeyMap.allowDown = 40;\n    KeyMap.allowUp = 38;\n    return (\n      <li\n        className={styles.li}\n        tabIndex={0}\n        onMouseOver={e => {\n          if (!this.state.listScrolling) {\n          this.focus(e.currentTarget);\n          }\n        }}\n        onKeyDown={e => {\n          this.lockScroll();\n          if (e.keyCode === KeyMap.enter) {\n            e.currentTarget.click();\n            e.preventDefault();\n          } else if (e.keyCode === KeyMap.allowUp && e.currentTarget.previousSibling) {\n            this.focus(e.currentTarget.previousSibling);\n          } else if (e.keyCode === KeyMap.allowDown) {\n            e.currentTarget.nextSibling && this.focus(e.currentTarget.nextSibling);\n          } else {\n            this.inputElement.current && this.focus(this.inputElement.current);\n          }\n        }}\n        onFocus={e => this.setState({ focus: e.currentTarget })}\n        onKeyUp={e => {\n          const heightHalf = (this.rootElement.current).clientHeight / 2;\n          this.unLockScroll();\n          if (e.currentTarget.offsetTop < heightHalf) this.scrollYTo(0);\n          else this.scrollYTo(e.currentTarget.offsetTop - heightHalf);\n        }}\n        onClick={e => {\n          this.unLockScroll();\n          this.props.onChenge(e.currentTarget.innerHTML.replace(/&amp;/, '&'));\n          this.setState({\n            value: e.currentTarget.innerHTML.replace(/&amp;/, '&'),\n            searchWord: ''\n          });\n        }}\n      >\n        {props.children}\n      </li>\n    );\n  }\n\n  render() {\n    return (\n      <div ref={this.rootElement} className={styles.incrementalSearch}>\n        <div className={styles.search}>\n          <this.Input />\n        </div>\n        {this.filter(this.props.option).length > 0 && (\n          <ul className={styles.ul} ref={this.ulElement}>\n            {this.filter(this.props.option).map(s => (\n              <this.ListItem key={s}>{s}</this.ListItem>\n            ))}\n          </ul>\n        )}\n      </div>\n    );\n  }\n}\n\nexport default IncrementalSearch;\n"]},"metadata":{},"sourceType":"module"}