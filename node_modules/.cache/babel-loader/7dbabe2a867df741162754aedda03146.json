{"ast":null,"code":"var _jsxFileName = \"/Users/yuzi/react/incremental_search/src/components/IncrementalSearch.js\";\nimport * as React from 'react';\nimport * as styles from './incrementalSearch.scss';\n\nclass IncrementalSearch extends React.Component {\n  /*\n  readonly state: {\n  searchWord: strin;\n  value: string;\n  focus: HTMLLIElement | HTMLInputElement | undefined;\n  listScrolling: boolean;\n  }\n  */\n\n  /*\n  readonly props: {\n    name: string;\n    value: string;\n    option: string[];\n    onChenge: (value: string) => void;\n    required?: boolean;\n  }\n  */\n  constructor(props) {\n    super(props);\n    this.rootElement = React.createRef();\n    this.ulElement = React.createRef();\n    this.inputElement = React.createRef();\n    console.log(props.option);\n    this.state = {\n      value: this.props.value,\n      searchWord: '',\n      focus: undefined,\n      listScrolling: false\n    };\n    this.Input = this.Input.bind(this);\n    this.ListItem = this.ListItem.bind(this);\n  }\n\n  filter(option) {\n    return option.map(s => s.match(new RegExp(this.state.searchWord.replace(' ', '|'), 'i')));\n  }\n\n  unLockScroll() {\n    document.body.classList.remove(styles.lock);\n    this.rootElement.current && this.rootElement.current.classList.remove(styles.lock);\n  }\n\n  lockScroll() {\n    document.body.classList.add(styles.lock);\n    this.rootElement.current && this.rootElement.current.classList.add(styles.lock);\n  }\n\n  scrollYTo(y\n  /* :number */\n  )\n  /* void */\n  {\n    this.setState({\n      listScrolling: true\n    });\n    this.rootElement.current.scrollTo(0, y);\n    this.setState({\n      listScrolling: false\n    });\n  }\n\n  onBlur() {\n    this.setState({\n      focus: undefined\n    });\n    clearTimeout(this.time);\n    this.time = setTimeout(() => {\n      if (this.state.focus === undefined) {\n        this.setState({\n          searchWord: ''\n        });\n      }\n    }, 200);\n  }\n\n  focus(element) {\n    element.focus();\n    this.setState({\n      focus: element\n    });\n  }\n\n  Input() {\n    var enter = 13;\n    var allowDown = 40;\n    var allowUp = 38;\n    return React.createElement(\"input\", {\n      ref: this.inputElement,\n      placeholder: \"input here\",\n      className: styles.input,\n      autoFocus: true,\n      onKeyDown: e => {\n        this.lockScroll();\n\n        if (e.keyCode === enter || e.keyCode === allowDown) {\n          try {\n            this.ulElement.current && this.focus(this.ulElement.current.children[0]);\n          } catch (e) {\n            console.error(e);\n          }\n        }\n      },\n      onFocus: e => this.setState({\n        focus: e.currentTarget\n      }),\n      onKeyUp: e => {\n        this.unLockScroll();\n        this.setState({\n          searchWord: e.currentTarget.value\n        });\n      },\n      onBlur: () => this.onBlur(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91\n      },\n      __self: this\n    });\n  }\n\n  ListItem(props) {\n    var enter = 13;\n    var allowDown = 40;\n    var allowUp = 38;\n    return React.createElement(\"li\", {\n      className: styles.li,\n      tabIndex: 0,\n      onMouseOver: e => {\n        if (!this.state.listScrolling) {\n          this.focus(e.currentTarget);\n        }\n      },\n      onKeyDown: e => {\n        this.lockScroll();\n\n        if (e.keyCode === enter) {\n          e.currentTarget.click();\n          e.preventDefault();\n        } else if (e.keyCode === allowUp && e.currentTarget.previousSibling) {\n          this.focus(e.currentTarget.previousSibling);\n        } else if (e.keyCode === allowDown) {\n          e.currentTarget.nextSibling && this.focus(e.currentTarget.nextSibling);\n        } else {\n          this.inputElement.current && this.focus(this.inputElement.current);\n        }\n      },\n      onFocus: e => this.setState({\n        focus: e.currentTarget\n      }),\n      onUp: e => {\n        const heightHalf = this.rootElement.current.clientHeight / 2;\n        this.unLockScroll();\n        if (e.currentTarget.offsetTop < heightHalf) this.scrollYTo(0);else this.scrollYTo(e.currentTarget.offsetTop - heightHalf);\n      },\n      onClick: e => {\n        this.unLockScroll();\n        this.props.onChenge(e.currentTarget.innerHTML.replace(/&amp;/, '&'));\n        this.setState({\n          value: e.currentTarget.innerHTML.replace(/&amp;/, '&'),\n          searchWord: ''\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121\n      },\n      __self: this\n    }, props.children);\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      ref: this.rootElement,\n      className: styles.incrementalSearch,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: styles.search,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166\n      },\n      __self: this\n    }, React.createElement(this.Input, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167\n      },\n      __self: this\n    })), this.filter(this.props.option).length > 0 && React.createElement(\"ul\", {\n      className: styles.ul,\n      ref: this.ulElement,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170\n      },\n      __self: this\n    }, this.filter(this.props.option).map(s => React.createElement(this.ListItem, {\n      key: s,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172\n      },\n      __self: this\n    }, s))));\n  }\n\n}\n\nIncrementalSearch.defaultProps = {\n  name: \"Example\",\n  value: \"Example\",\n  option: ['Japan', 'US', 'Russia', 'Korea']\n};\nexport default IncrementalSearch;","map":{"version":3,"sources":["/Users/yuzi/react/incremental_search/src/components/IncrementalSearch.js"],"names":["React","styles","IncrementalSearch","Component","constructor","props","rootElement","createRef","ulElement","inputElement","console","log","option","state","value","searchWord","focus","undefined","listScrolling","Input","bind","ListItem","filter","map","s","match","RegExp","replace","unLockScroll","document","body","classList","remove","lock","current","lockScroll","add","scrollYTo","y","setState","scrollTo","onBlur","clearTimeout","time","setTimeout","element","enter","allowDown","allowUp","input","e","keyCode","children","error","currentTarget","li","click","preventDefault","previousSibling","nextSibling","heightHalf","clientHeight","offsetTop","onChenge","innerHTML","render","incrementalSearch","search","length","ul","defaultProps","name"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport * as styles from './incrementalSearch.scss';\n\nclass IncrementalSearch extends React.Component {\n    /*\n  readonly state: {\n    searchWord: strin;\n    value: string;\n    focus: HTMLLIElement | HTMLInputElement | undefined;\n    listScrolling: boolean;\n  }\n  */\n  /*\n  readonly props: {\n    name: string;\n    value: string;\n    option: string[];\n    onChenge: (value: string) => void;\n    required?: boolean;\n  }\n  */\n  constructor(props) {\n    super(props);\n    console.log(props.option);\n    this.state = {\n        value: this.props.value,\n        searchWord: '',\n        focus: undefined,\n        listScrolling: false,\n    };\n    this.Input = this.Input.bind(this);\n    this.ListItem = this.ListItem.bind(this);\n  }\n\n  filter(option) {\n    return option.map( s =>\n       s.match(new RegExp(this.state.searchWord.replace(' ', '|'), 'i'))\n    );\n  }\n\n  rootElement = React.createRef();\n  ulElement = React.createRef();\n  inputElement = React.createRef();\n\n  unLockScroll() {\n    document.body.classList.remove(styles.lock);\n    this.rootElement.current && this.rootElement.current.classList.remove(styles.lock);\n  }\n\n  lockScroll() {\n    document.body.classList.add(styles.lock);\n    this.rootElement.current &&\n      this.rootElement.current.classList.add(styles.lock);\n  }\n\n  scrollYTo(y /* :number */) /* void */ {\n    this.setState({listScrolling: true});\n    (this.rootElement.current).scrollTo(0, y);\n    this.setState({listScrolling: false});\n  }\n\n  onBlur() {\n    this.setState({\n      focus: undefined\n    });\n    clearTimeout(this.time);\n    this.time = setTimeout(() => {\n      if (this.state.focus === undefined) {\n        this.setState({\n          searchWord: ''\n        });\n      }\n    }, 200);\n  }\n\n  focus(element) {\n    element.focus();\n    this.setState({\n      focus: element\n    });\n  }\n\n  time;\n\n  Input() {\n    var enter =  13;\n    var allowDown = 40;\n    var allowUp = 38;\n\n    return (\n      <input\n        ref={this.inputElement}\n        placeholder={`input here`}\n        className={styles.input}\n        autoFocus\n        onKeyDown={e => {\n          this.lockScroll();\n          if (e.keyCode === enter || e.keyCode === allowDown) {\n            try {\n              this.ulElement.current && this.focus(this.ulElement.current.children[0]);\n            } catch (e) {\n              console.error(e);\n            }\n          }\n        }}\n        onFocus={e => this.setState({ focus: e.currentTarget })}\n        onKeyUp={e => {\n          this.unLockScroll();\n          this.setState({ searchWord: e.currentTarget.value });\n        }}\n        onBlur={() => this.onBlur()}\n      />\n    );\n  }\n\n  ListItem(props) {\n    var enter =  13;\n    var allowDown = 40;\n    var allowUp = 38;\n    return (\n      <li\n        className={styles.li}\n        tabIndex={0}\n        onMouseOver={e => {\n          if (!this.state.listScrolling) {\n          this.focus(e.currentTarget);\n          }\n        }}\n        onKeyDown={e => {\n          this.lockScroll();\n          if (e.keyCode === enter) {\n            e.currentTarget.click();\n            e.preventDefault();\n          } else if (e.keyCode === allowUp && e.currentTarget.previousSibling) {\n            this.focus(e.currentTarget.previousSibling);\n          } else if (e.keyCode === allowDown) {\n            e.currentTarget.nextSibling && this.focus(e.currentTarget.nextSibling);\n          } else {\n            this.inputElement.current && this.focus(this.inputElement.current);\n          }\n        }}\n        onFocus={e => this.setState({ focus: e.currentTarget })}\n        onUp={e => {\n          const heightHalf = (this.rootElement.current).clientHeight / 2;\n          this.unLockScroll();\n          if (e.currentTarget.offsetTop < heightHalf) this.scrollYTo(0);\n          else this.scrollYTo(e.currentTarget.offsetTop - heightHalf);\n        }}\n        onClick={e => {\n          this.unLockScroll();\n          this.props.onChenge(e.currentTarget.innerHTML.replace(/&amp;/, '&'));\n          this.setState({\n            value: e.currentTarget.innerHTML.replace(/&amp;/, '&'),\n            searchWord: ''\n          });\n        }}\n      >\n        {props.children}\n      </li>\n    );\n  }\n\n  render() {\n    return (\n      <div ref={this.rootElement} className={styles.incrementalSearch}>\n        <div className={styles.search}>\n          <this.Input />\n        </div>\n        {this.filter(this.props.option).length > 0 && (\n          <ul className={styles.ul} ref={this.ulElement}>\n            {this.filter(this.props.option).map(s => (\n              <this.ListItem key={s}>{s}</this.ListItem>\n            ))}\n          </ul>\n        )}\n      </div>\n    );\n  }\n}\nIncrementalSearch.defaultProps = {\n    name : \"Example\",\n    value : \"Example\",\n    option : ['Japan', 'US', 'Russia', 'Korea'],\n };\n\nexport default IncrementalSearch;\n"]},"metadata":{},"sourceType":"module"}